<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Player de Música</title>
</head>
<body>
    <audio id="persistentAudio" loop preload="auto">
        <source src="" type="audio/mpeg">
        Seu navegador não suporta o elemento de áudio.
    </audio>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const audio = document.getElementById("persistentAudio");
            if (localStorage.getItem("musicAllowed") === "true") {
                // Usa a música definida ou a padrão ("memories.mp3")
                let musicaAtual = localStorage.getItem("currentMusic") || "memories.mp3";
                if (audio.src.indexOf(musicaAtual) === -1) {
                    audio.src = musicaAtual;
                    audio.load();
                }
                // Se houver um tempo salvo, restaura a posição
                if (localStorage.getItem("musicTime")) {
                    audio.currentTime = localStorage.getItem("musicTime");
                }
                audio.play().catch(err => {
                    console.warn("Autoplay bloqueado ou aguardando interação:", err);
                });
            }
            audio.addEventListener("timeupdate", function() {
                localStorage.setItem("musicTime", audio.currentTime);
            });
            // Se a música mudar em outra página, o listener de storage atualizará
            window.addEventListener("storage", function(event) {
                if (event.key === "currentMusic") {
                    audio.src = event.newValue;
                    audio.load();
                    audio.play();
                }
            });
        });
    </script>
</body>
</html>
