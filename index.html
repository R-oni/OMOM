<!-- index.html -->
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OMOM SPA</title>

  <!-- fonte pixel art -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    /* ===== ESTILOS GERAIS ===== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html {
      width: 100%; height: 100%;
      overflow: hidden;
      background: black; color: white;
      font-family: 'Courier New', monospace;
    }

    /* painel translúcido sobre o globo */
    #painel{
      position: fixed; inset: 0;
      width: 100vw; height: 100vh;
      object-fit: cover; object-position: center;
      z-index: 2; pointer-events: none;
    }

    /* grid 50/50 (globo / flipbook) */
    #app{
      display: grid;
      grid-template-rows: 50% 50%;
      width: 100vw; height: 100vh;
      position: relative;
    }

    /* ---------- TELA DE CARREGAMENTO ---------- */
    #loading-screen{
      position: fixed; inset: 0;
      display: flex; align-items: center; justify-content: center;
      background: black; z-index: 9999;
    }
    #loading-text{
      font-family: 'Press Start 2P', cursive;
      color: #00FFE7; font-size: 20px;
    }

    /* ---------- PROMPT “SOM? [SIM | NÃO]” ---------- */
    #soundPrompt{
      position: fixed; inset: 0;
      display: none;                       /* mostrado após load */
      flex-direction: column;
      align-items: center; justify-content: center;
      background: black; z-index: 10000;
    }
    #soundPrompt p{
      font-family: 'Press Start 2P', cursive;
      color: #00FFE7; font-size: 24px;
      margin-bottom: 30px; text-align: center;
    }
    .soundBtn{
      background: none; border: 2px solid #00FFE7;
      color: #00FFE7; font-family: 'Press Start 2P', cursive;
      font-size: 14px; padding: 12px 22px;
      cursor: pointer; transition: background .25s;
    }
    .soundBtn:hover{ background: #00FFE733; }
    .btnWrap{ display: flex; gap: 40px; }

    /* ---------- ÁREA DO GLOBO ---------- */
    #globe-area, #flipbook-area{
      position: relative;
      display: flex; align-items: center; justify-content: center;
      width: 100%;
    }
    #globe-area{
      z-index: 0; width: 80%; height: 100%;
      margin: 0 auto; position: relative;
    }
    #globeCanvas{
      width: 100%; height: 100%;
      max-height: 100%; object-fit: contain;
    }

    /* vídeo de abertura */
    #intro-video{
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 40vw; height: auto;
      z-index: 1; pointer-events: none;
      display: none;                      /* só exibe depois do prompt */
    }

    /* botão MENU (invisível no início) */
    #btnMenu{
      display: none;
      position: absolute; top: 25px; left: 10px;
      background: rgba(0,0,0,0.7);
      color: #00FFE7; border: 2px solid #00FFE7;
      font-family: 'Press Start 2P', cursive;
      font-size: 6px; padding: 10px; cursor: pointer;
      z-index: 999;
    }
    #btnMenu:hover{ background: rgba(0,0,0,0.9); }

    /* ---------- ÁREA DO FLIPBOOK ---------- */
    #flipbook-area{
      margin-left: 5%; padding-top: 2vh;
      overflow: hidden;
      width: 100%; height: 100%;
      z-index: 3;
      transform: translateX(100%);
      transition: transform 1.5s ease-out;
    }
    #flipbook-area.show{ transform: translateX(0); }
    #flipbook-area.slide-out-left{ transform: translateX(-100%); }
    #flipbookContainer{ width: 100%; height: calc(100% - 7vh); }

    /* seta menor no flipbook */
    #flipbook-area #setaBtn{
      position: absolute; top: 5px !important; right: 5px;
      width: 35px !important; height: auto !important;
      cursor: pointer; opacity: 0;
      animation:
        fadeInArrow .6s forwards .4s,
        slideArrow 1s ease-in-out infinite .6s;
      z-index: 5;
    }
    @keyframes fadeInArrow{ from{opacity:0;} to{opacity:1;} }
    @keyframes slideArrow{
      0%{transform:translate(0,0);}
      50%{transform:translate(-8px,8px);}
      100%{transform:translate(0,0);}
    }

    /* imagens clicáveis no flipbook */
    #cliquemundo, #cliqueinversao, #cliquerefracao,
    #cliquemorse, #cliquecapacitor, #cliquesanguedomundo, #cliqueg{
      position: absolute; inset: 0;
      cursor: pointer; width: 100%; height: 100%;
      z-index: 10; animation: fadeInOut .7s infinite;
    }
    @keyframes fadeInOut{
      0%{opacity:1;} 50%{opacity:0;} 100%{opacity:1;}
    }

    /* ---------- MENU ROLANTE ---------- */
    #menu-overlay{
      position: absolute; inset: 0;
      backdrop-filter: blur(6px);
      display: none; z-index: 1;
    }
    #menu-overlay.visible{ display: block; }

    .symbols-wrapper{
      position: absolute; top:40px; inset-inline:0; bottom:0;
      overflow-y: auto; padding:20px;
    }
    .symbols-container{
      display: flex; flex-wrap: wrap;
      justify-content: center; gap: 25px;
    }
    .symbol{ cursor: pointer; transition: transform .1s; }
    .symbol img{ width: 18vw; transition: transform .3s; }
    .symbol img:hover{ transform: scale(1.1); }
    .symbol.brither img{ filter: brightness(180%); }
    .symbol.locked  img{ filter: brightness(50%); }

    /* ---------- OVERLAY DE IMAGEM ---------- */
    #overlayContainer{
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.8);
      display: none; justify-content: center; align-items: center;
      z-index: 1000;
    }
    #overlayImage{ max-width:80%; max-height:80%; transition: transform .3s; }
    #btnSair{
      position: absolute; top:20px; right:20px;
      background: rgba(0,0,0,0.7); color:#00FFE7;
      border:2px solid #00FFE7;
      font-family:'Press Start 2P',cursive;
      font-size:12px; padding:10px; cursor:pointer;
      z-index:1001;
    }
  </style>
</head>

<body>
  <!-- áudios originais -->
  <audio id="bgm"      src="animus.mp3"   loop preload="auto"></audio>
  <audio id="memories" src="memories.mp3" loop preload="auto"></audio>

  <img id="painel" src="painel.png" alt="Painel">

  <!-- Prompt de som -->
  <div id="soundPrompt">
    <p>SOM?</p>
    <div class="btnWrap">
      <button class="soundBtn" id="btnYes">SIM</button>
      <button class="soundBtn" id="btnNo">NÃO</button>
    </div>
  </div>

  <div id="app">
    <!--‑‑‑ Globo ‑‑‑>
    <div id="globe-area">
      <canvas id="globeCanvas"></canvas>

      <video id="intro-video" src="omom.mp4" muted playsinline></video>

      <button id="btnMenu">MENU</button>

  
      <div id="menu-overlay">
        <div class="symbols-wrapper">
          <div class="symbols-container">
            <div class="symbol brither" data-world="veleywei">
              <img src="assets/veleyweimenu.png" alt="Velei'wey">
            </div>
            <div class="symbol locked" data-world="botychera">
              <img src="mundos/botychera/botycheramenu.png" alt="Botychera">
            </div>
            <div class="symbol locked" data-world="himpis">
              <img src="mundos/himpis/himpismenu.png" alt="Himpis">
            </div>
            <div class="symbol brither" data-world="batedores">
              <img src="mundos/ttok/ttokmenu.png" alt="Batedores">
            </div>
            <div class="symbol locked" data-world="denbou">
              <img src="mundos/denbou/denboumenu.png" alt="DenDenBouBou">
            </div>
            <div class="symbol locked" data-world="araporu">
              <img src="mundos/araporu/araporumenu.png" alt="Araporu">
            </div>
            <div class="symbol locked" data-world="artesaos">
              <img src="mundos/os artesaos/artesaosmenu.png" alt="Artesãos">
            </div>
            <div class="symbol locked" data-world="sapador">
              <img src="mundos/sapador/sapador.png" alt="Sapador">
            </div>
            <div class="symbol locked" data-world="dosirelala">
              <img src="mundos/dosirelala/dosirelalamenu.png" alt="Dosirelala">
            </div>
            <div class="symbol locked" data-world="calindreno">
              <img src="mundos/calindreno/calindreno.png" alt="Calindreno">
            </div>
            <div class="symbol locked" data-world="mundoPulsante">
              <img src="mundos/mundo pulsante/jocelyn.png" alt="Mundo Pulsante">
            </div>
        
          </div>
        </div>
      </div>
    </div>

  
    <div id="flipbook-area">
      <div id="flipbookContainer"></div>
    </div>
  </div>

  <!-- overlay imagem -->
  <div id="overlayContainer">
    <button id="btnSair">FECHAR</button>
    <img id="overlayImage" src="" alt="Imagem em destaque">
  </div>

  <!-- loading -->
  <div id="loading-screen">
    <div id="loading-text">CARREGANDO...</div>
  </div>

  <!-- libs -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="turn.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

  <script>
    /* ========== FUNÇÕES DE FADE (já existiam) ========== */
    function fadeIn(audio, ms){
      audio.volume = 0;
      audio.play().catch(()=>{});
      const step = 50, dv = step / ms;
      const id = setInterval(()=>{
        if(audio.volume + dv >= 1){ audio.volume = 1; clearInterval(id); }
        else audio.volume += dv;
      }, step);
    }
    function fadeOut(audio, ms){
      const step = 50, dv = step / ms;
      const id = setInterval(()=>{
        if(audio.volume - dv <= 0){
          audio.volume = 0; clearInterval(id);
          audio.pause(); audio.currentTime = 0;
        } else audio.volume -= dv;
      }, step);
    }

    /* ========== VARIÁVEL DE CONTROLE ========== */
    let allowSound = false;

    /* ========== DESTRÓI GLOBO (sem alterações) ========== */
    function destroyGlobe(){
      const G = window._Globe;
      if(G){
        if(G.scene){
          G.scene.traverse(o=>{
            o.geometry?.dispose();
            if(o.material){
              Array.isArray(o.material) ? o.material.forEach(m=>m.dispose()) : o.material.dispose();
            }
          });
          G.scene = null;
        }
        if(G.renderer){
          G.renderer.dispose();
          G.renderer.forceContextLoss?.();
          G.renderer.domElement?.parentNode?.removeChild(G.renderer.domElement);
          G.renderer = null;
        }
        G.controls?.dispose(); G.controls = null;
      }
      const area = document.getElementById('globe-area');
      area.querySelector('canvas')?.remove();
      ['sapetyrGloboImage','sangueGloboImage'].forEach(id=>document.getElementById(id)?.remove());
      const c=document.createElement('canvas'); c.id='globeCanvas'; area.prepend(c);
    }

    /* ========== BOOT (loading + prompt) ========== */
    window.addEventListener('load',()=>{
      document.getElementById('loading-screen').style.display = 'none';
      document.getElementById('soundPrompt').style.display  = 'flex';
    });

    /* ========== START SITE APÓS ESCOLHA ========== */
    function startSite(sound){
      allowSound = sound;
      document.getElementById('soundPrompt').style.display = 'none';

      const intro = document.getElementById('intro-video');
      intro.style.display = 'block';
      intro.play().catch(()=>{});

      /* se escolheu SIM, toca ambos */
      if(allowSound){
        document.getElementById('bgm').play().catch(()=>{});
        document.getElementById('memories').play().catch(()=>{});
      }

      intro.addEventListener('ended',()=>{
        intro.style.display='none';
        showOverlayMenu();
      });
    }

    document.getElementById('btnYes').onclick = ()=>startSite(true);
    document.getElementById('btnNo').onclick  = ()=>startSite(false);

    /* ========== MENU E FLIPBOOK (código original) ========== */
    const memories = document.getElementById('memories');

    function showOverlayMenu(){
      const ov = document.getElementById('menu-overlay');
      ov.style.display='block'; ov.style.opacity='1'; ov.classList.add('visible');
      document.querySelector('.symbols-container').classList.add('animate-symbols');
      if(allowSound) fadeIn(memories, 1000);
    }

    document.querySelector('.symbols-container').addEventListener('click',e=>{
      const sym=e.target.closest('.symbol'); if(!sym) return;
      launchWorld(sym.dataset.world);
    });
    document.getElementById('btnMenu').onclick = showOverlayMenu;

    function launchWorld(name){
      const fb=document.getElementById('flipbook-area');
      if(fb.classList.contains('show')){
        fb.classList.remove('show'); fb.classList.add('slide-out-left');
        fb.addEventListener('transitionend', onOut);
      }else{ loadWorld(name); }
      function onOut(){
        fb.classList.remove('slide-out-left'); fb.removeEventListener('transitionend', onOut);
        loadWorld(name);
      }
    }

    function loadWorld(worldName){
      if(allowSound) fadeOut(memories, 1000);

      destroyGlobe();

      const ov=document.getElementById('menu-overlay');
      ov.classList.remove('visible'); ov.style.display='none'; ov.style.opacity='';

      document.getElementById('btnMenu').style.display='block';

      document.getElementById('flipbookContainer').innerHTML='';
      const s=document.createElement('script'); s.src=worldName+'.js'; document.body.appendChild(s);
      s.onload=()=>{
        window.initGlobe?.('#globeCanvas');
        window.initFlipbook?.('#flipbookContainer');
        const fb=document.getElementById('flipbook-area'); void fb.offsetWidth; fb.classList.add('show');
      };
    }

    /* ========== OVERLAY DE IMAGEM (igual) ========== */
    document.getElementById('btnSair').onclick=e=>{
      e.preventDefault(); $('#overlayContainer').fadeOut(300);
    };
    document.getElementById('overlayContainer').onclick=e=>{
      if(e.target===e.currentTarget) $('#overlayContainer').fadeOut(300);
    };
  </script>
</body>
</html>
