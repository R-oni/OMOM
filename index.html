<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OMOM SPA</title>

  <!-- fonte pixel-art -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

  <style>
    /* ===== RESET ===== */
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body {
      width:100%; height:100%; overflow:hidden;
      background:#000; color:#fff;
      font-family:'Courier New',monospace;
    }

    /* ===== ORIENTATION LOCK ===== */
    #orientation-overlay {
      position: fixed; inset: 0;
      background: #000; color: #fff;
      display: none; align-items: center; justify-content: center;
      z-index: 100000; text-align: center;
      padding: 20px; font-size: 18px;
    }
    @media screen and (orientation: landscape) {
      #orientation-overlay { display: flex; }
      #app, #omom-screen, #loading-screen, #soundPrompt {
        display: none !important;
      }
    }

    /* ===== CONTAINER PRINCIPAL ===== */
    #app { width:100%; height:100%; position: relative; background: #000; }

    /* ===== TELA INICIAL OMOM ===== */
    #omom-screen {
      position: fixed; inset: 0; background: #000;
      display: flex; align-items: center; justify-content: center;
      z-index: 9998;
    }
    #omom-title {
      font-family: 'Press Start 2P', cursive;
      font-size: 48px; color: white;
      opacity: 0; animation: fadeInTitle 2s ease-in-out forwards;
    }
    @keyframes fadeInTitle { from{opacity:0} to{opacity:1} }

    /* ===== MENU DE SÍMBOLOS ===== */
    #menu-overlay {
      position: fixed; inset: 0;
      background: url(fundo.webp) center/cover no-repeat;
      display: none; align-items: center; justify-content: center;
      z-index: 9999;
    }
    #menu-overlay::before {
      content: ''; position: absolute; inset: 0;
      background: rgba(0,0,0,0.6); backdrop-filter: blur(6px);
    }
    #menu-overlay.visible { display: flex; }
    .symbols-wrapper { position: relative; max-width: 90vw; max-height: 80vh; padding: 20px; overflow-y: auto; z-index:1 }
    .symbols-container { display:flex; flex-wrap:wrap; justify-content:center; gap:25px }
    @keyframes floatWave {0%{transform:translateY(0)}50%{transform:translateY(-4px)}100%{transform:translateY(0)}}
    .symbol { cursor:pointer; animation:floatWave 4s ease-in-out infinite }
    .symbol img { width:18vw; max-width:120px; transition:transform .3s }
    .symbol img:hover { transform:scale(1.1) }
    .symbol.brither img { filter:brightness(180%) }
    .symbol.locked img { filter:brightness(50%) }

    /* ===== FLIPBOOK AREA ===== */
    #flipbook-area {
      position: fixed; inset:0; background:#000;
      display:flex; align-items:center; justify-content:center;
      z-index:1000; transition: transform 1.5s ease-out;
      transform: translateY(100%);
    }
    @media screen and (orientation: portrait) {
      #flipbook-area {
        width:90vh; height:95vw;
        transform: translateY(100%) rotate(90deg);
        transform-origin: bottom left;
      }
      #flipbook-area.show { transform: translateY(0) rotate(90deg); }
      #flipbook-area.slide-out-down { transform: translateY(100%) rotate(90deg); }
      #flipbookContainer { width:95vh; height:85vw; }
    }
    @media screen and (min-width:1024px) {
      #flipbook-area { transform: translateY(100%); }
      #flipbook-area.show { transform: translateY(0); }
      #flipbook-area.slide-out-down { transform: translateY(100%); }
      #flipbookContainer { width:80vw; height:80vh; max-width:1000px; max-height:700px }
    }

    /* ===== RESTANTE (overlay, loading, som, botões) – igual ao anterior... ===== */
    /* ... */
  </style>
</head>

<body>
  <div id="orientation-overlay">Por favor, gire o dispositivo para o modo retrato.</div>
  <audio id="bgm" src="animus.mp3" preload="auto" loop></audio>
  <audio id="memories" src="memories.mp3" preload="auto" loop></audio>

  <div id="loading-screen"><div id="loading-text">CARREGANDO…</div></div>

  <div id="soundPrompt">
    <p>SOM?</p>
    <div class="btnWrap">
      <button class="soundBtn" id="btnYes">SIM</button>
      <button class="soundBtn" id="btnNo">NÃO</button>
    </div>
  </div>

  <div id="omom-screen"><div id="omom-title">OMOM</div></div>

  <div id="app">
    <div id="menu-overlay">
      <div class="symbols-wrapper">
        <div class="symbols-container">
          <!-- seus símbolos aqui -->
        </div>
      </div>
    </div>
    <div id="flipbook-area">
      <button id="btnVoltar">VOLTAR</button>
      <div id="flipbookContainer"></div>
    </div>
  </div>

  <div id="overlayContainer">
    <button id="btnSair">FECHAR</button>
    <img id="overlayImage" src="" alt="Zoom">
  </div>

  <!-- libs -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="turn.js"></script>
  <script src="three.min.js"></script>
  <script src="OrbitControls.js"></script>

  <script>
    // funções de áudio, boot e menu (iguais à versão anterior)...
    // ...

    // ==== FLIPBOOK & SWIPE ==== 
    let flipbookElem = null;

    function bindSwipeAndKeys() {
      if (!flipbookElem) return;
      let startY=0, startX=0;
      flipbookElem.on('touchstart', function(e){
        const t = e.originalEvent.touches[0];
        startY = t.clientY;
        startX = t.clientX;
      });
      flipbookElem.on('touchend', function(e){
        const t = e.originalEvent.changedTouches[0];
        const dy = t.clientY - startY;
        const dx = t.clientX - startX;
        if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > 30) {
          if (dy < 0) flipbookElem.turn('next');
          else flipbookElem.turn('previous');
        }
      });
      $(document).off('keydown.flip').on('keydown.flip', function(e){
        if ($('#flipbook-area').hasClass('show')) {
          if (e.key === 'ArrowUp' || e.key === 'ArrowRight') flipbookElem.turn('next');
          if (e.key === 'ArrowDown' || e.key === 'ArrowLeft') flipbookElem.turn('previous');
        }
      });
    }

    function loadWorld(name) {
      $('#flipbookContainer').empty();
      $('#btnVoltar').addClass('show');
      const s = document.createElement('script');
      s.src = name + '.js';
      document.body.appendChild(s);
      s.onload = () => {
        window.initFlipbook?.('#flipbookContainer');
        // logo após inicializar, capturamos o elemento .flipbook gerado
        flipbookElem = $('#flipbookContainer').find('.flipbook');
        // e vinculamos swipe + teclas
        bindSwipeAndKeys();
        // exibimos o flipbook
        const fb = $('#flipbook-area');
        void fb[0].offsetWidth;
        fb.addClass('show');
      };
    }

    // substitua a chamada original por esta:
    document.querySelector('.symbols-container').addEventListener('click', e => {
      const sym = e.target.closest('.symbol');
      if (!sym || sym.classList.contains('locked')) return;
      hideMenu();
      const fb = $('#flipbook-area');
      if (fb.hasClass('show')) {
        fb.removeClass('show').addClass('slide-out-down');
        setTimeout(() => {
          fb.removeClass('slide-out-down');
          loadWorld(sym.dataset.world);
        }, 1500);
      } else {
        loadWorld(sym.dataset.world);
      }
    });

    $('#btnVoltar').click(() => {
      const fb = $('#flipbook-area');
      fb.removeClass('show').addClass('slide-out-down');
      $('#btnVoltar').removeClass('show');
      setTimeout(() => {
        fb.removeClass('slide-out-down');
        $('#flipbookContainer').empty();
        showMenu();
        // desligamos listener de teclas
        $(document).off('keydown.flip');
      }, 1500);
    });
  </script>
</body>
</html>
