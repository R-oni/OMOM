<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=yes"/>
  <title>OMOM SPA</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    html, body {
      width:100%; height:100%; overflow:hidden;
      background:#000; color:#fff;
      font-family:'Courier New',monospace;
      transition: background 1s ease;
    }
    /* Splash OMOM */
    #omom-screen {
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background:#000; z-index:10;
    }
    #omom-title {
      font-family:'Press Start 2P',cursive;
      font-size:8vw; max-font-size:64px; color:#fff;
      opacity:0;
      animation:fadeIn 1s forwards, fadeOut 0.5s 2s forwards;
    }

    /* Tela de Apoiadores */
    #supporters-screen {
      position:fixed; inset:0;
      display:none;
      flex-direction:column; align-items:center; justify-content:center;
      background:#000; z-index:9;
      padding:5vh;
    }
    #supporters-title {
      font-family:'Press Start 2P',cursive;
      font-size:5vw; max-font-size:32px; color:#00FFE7;
      margin-bottom:5vh;
      text-align:center;
    }
    .supporters-list {
      text-align:center;
      line-height:1.8;
    }
    .supporter-name {
      font-family:'Press Start 2P',cursive;
      font-size:3.5vw; max-font-size:20px; color:#fff;
      margin-bottom:2vh;
      display:block;
    }

    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    @keyframes fadeOut { from{opacity:1} to{opacity:0} }

    /* Prompt Som */
    #soundPrompt {
      position:fixed; inset:0;
      display:none;
      flex-direction:column; align-items:center; justify-content:center;
      background:#000; z-index:8;
      text-align:center;
      margin-top:20vh;
    }
    #soundPrompt p {
      font-family:'Press Start 2P',cursive;
      font-size:5vw; max-font-size:24px;
      margin-bottom:4vh;
      color:#00FFE7;
    }
    .soundBtns { 
      display:flex; gap:4vw; 
      justify-content:center;
      align-items:center;
    }
    .soundBtn {
      padding:2vh 4vw;
      font-family:'Press Start 2P',cursive;
      font-size:4vw; max-font-size:16px;
      background:none; border:2px solid #00FFE7; color:#00FFE7;
      cursor:pointer;
      transition: all 0.3s ease;
    }
    .soundBtn:hover {
      background:#00FFE7;
      color:#000;
    }

    /* Menu de Símbolos */
    #menu {
      position:fixed; inset:0;
      display:none;
      flex-direction:column; align-items:center; justify-content:flex-start;
      z-index:7; padding:10vh 5vw 5vh;
      background:#000;
      transition: background 1s ease;
    }
    #menu h1 {
      font-family:'Press Start 2P',cursive;
      font-size:6vw; max-font-size:48px; color:#fff;
      margin-bottom:8vh;
      text-align:center;
    }
    .symbols-container {
      display:flex; flex-wrap:wrap;
      justify-content:center; gap:5vw;
      width:100%;
    }
    .symbol {
      cursor:pointer;
      animation:floatWave 4s ease-in-out infinite;
    }
    .symbol img {
      width:20vw; max-width:180px; display:block;
    }
    @keyframes floatWave { 0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)} }
    .symbol.locked { opacity:0.3; pointer-events:none; }

    /* Flipbook / Swiper */
    #flipbook {
      position:fixed; inset:0;
      display:none;
      flex-direction:column; align-items:center; justify-content:center;
      background:#fff; z-index:6;
      transition: background 1s ease;
    }
    .swiper-container {
      width:95vw; height:63vh; /* Aumentado em 5% */
      max-width:630px; max-height:472px; /* Aumentado em 5% */
      margin:auto;
      touch-action: none;
    }
    .swiper-slide {
      display:flex; align-items:center; justify-content:center;
      touch-action: none;
      position: relative;
      overflow: hidden;
      transform-origin: center center;
      transition: transform 0.3s ease;
    }
    .swiper-slide img,
    .swiper-slide canvas {
      width:100%; height:100%; object-fit:contain;
      border-radius:8px;
      transform-origin: center center;
    }

    /* Fade Top/Bottom apenas no flipbook */
    #fadeTop, #fadeBottom {
      position:fixed; left:0; width:100%; height:15%; z-index:8;
      pointer-events:none; display:none;
    }
    #fadeTop { 
      top:0; 
      background: linear-gradient(to bottom, 
        rgba(0,0,0,0.9) 0%, 
        rgba(0,0,0,0.7) 30%, 
        rgba(0,0,0,0.3) 60%,
        rgba(0,0,0,0) 100%); 
    }
    #fadeBottom { 
      bottom:0; 
      background: linear-gradient(to top, 
        rgba(0,0,0,0.9) 0%, 
        rgba(0,0,0,0.7) 30%, 
        rgba(0,0,0,0.3) 60%,
        rgba(0,0,0,0) 100%); 
    }

    /* Voltar */
    #btnVoltar {
      position:fixed; top:5vh; left:5vw;
      padding:1vh 2vw;
      font-family:'Press Start 2P',cursive;
      font-size:3vw; max-font-size:14px;
      background:rgba(0,0,0,0.8);
      border:2px solid #00FFE7;
      color:#00FFE7;
      cursor:pointer; display:none; z-index:10;
      backdrop-filter: blur(5px);
    }

    /* ================================= */
    /* VERSÃO DESKTOP - Media Queries   */
    /* ================================= */
    @media screen and (min-width: 768px) {
      #omom-title {
        font-size:4rem;
      }
      
      #supporters-title {
        font-size:2rem;
      }
      
      .supporter-name {
        font-size:1.2rem;
      }
      
      #soundPrompt p {
        font-size:1.5rem;
      }
      
      .soundBtn {
        font-size:1rem;
        padding:15px 30px;
      }
      
      #menu h1 {
        font-size:3rem;
      }
      
      .symbol img {
        width:150px;
      }
      
      #btnVoltar {
        font-size:12px;
        padding:10px 20px;
      }
    }
  </style>
</head>
<body>
  <audio id="memories" src="memories.mp3" preload="auto" loop></audio>

  <div id="omom-screen"><div id="omom-title">OMOM</div></div>

  <div id="supporters-screen">
    <div id="supporters-title">APOIADORES</div>
    <div class="supporters-list">
      <span class="supporter-name">Sebastiana Ricardo</span>
      <span class="supporter-name">Tatiana Torres</span>
      <span class="supporter-name">Glória Anunciação</span>
      <span class="supporter-name">Ana Aprígio</span>
    </div>
  </div>

  <div id="soundPrompt">
    <p>Som?</p>
    <div class="soundBtns">
      <button class="soundBtn" id="btnYes">SIM</button>
      <button class="soundBtn" id="btnNo">NÃO</button>
    </div>
  </div>

  <div id="menu">
    <h1>OMOM</h1>
    <div class="symbols-container">
      <div class="symbol brither" data-world="veleywei">
        <img src="assets/veleyweimenu.png" alt="Veleywei">
      </div>
      <div class="symbol brither" data-world="batedores">
        <img src="mundos/ttok/ttokmenu.png" alt="Batedores">
      </div>
    </div>
  </div>

  <div id="flipbook">
    <button id="btnVoltar">VOLTAR</button>
    <div class="swiper-container" id="swiper">
      <div class="swiper-wrapper"></div>
    </div>
  </div>

  <div id="fadeTop"></div>
  <div id="fadeBottom"></div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>
  <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
  <script>
    let allowSound = false;
    const memories = document.getElementById('memories');
    let hammerManager = null;
    let currentSwiper = null;
    let currentScale = 1;
    let isZoomedIn = false;

    // Detecta se é dispositivo móvel
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
             ('ontouchstart' in window) || 
             (navigator.maxTouchPoints > 0);
    }

    // Configuração do zoom para mobile (pinch)
    function setupMobilePinch(slideEl) {
      if (hammerManager) {
        hammerManager.destroy();
        hammerManager = null;
      }
      
      // Reset all slides to scale 1
      document.querySelectorAll('.swiper-slide').forEach(s => {
        s.style.transform = 'scale(1)';
        s.style.zIndex = '1';
      });
      
      hammerManager = new Hammer(slideEl);
      hammerManager.get('pinch').set({ enable: true });
      
      let scale = 1;
      let initialScale = 1;
      
      hammerManager.on('pinchstart', (ev) => {
        initialScale = currentScale;
        // Disable swiper touch during pinch
        if (currentSwiper) {
          currentSwiper.allowTouchMove = false;
        }
        // Bring current slide to front
        slideEl.style.zIndex = '10';
      });
      
      hammerManager.on('pinchmove', (ev) => {
        scale = Math.max(1, Math.min(initialScale * ev.scale, 3));
        slideEl.style.transform = `scale(${scale})`;
        currentScale = scale;
        isZoomedIn = scale > 1.05;
      });
      
      hammerManager.on('pinchend', () => {
        if (scale < 1.05) {
          slideEl.style.transform = 'scale(1)';
          slideEl.style.zIndex = '1';
          currentScale = 1;
          isZoomedIn = false;
        }
        
        // Re-enable swiper touch after pinch
        setTimeout(() => {
          if (currentSwiper) {
            currentSwiper.allowTouchMove = true;
          }
        }, 100);
      });
    }

    // Configuração do zoom para desktop (scroll do mouse)
    function setupDesktopScroll(slideEl) {
      slideEl.addEventListener('wheel', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        // Reset other slides
        document.querySelectorAll('.swiper-slide').forEach(s => {
          if (s !== slideEl) {
            s.style.transform = 'scale(1)';
            s.style.zIndex = '1';
          }
        });
        
        const delta = e.deltaY;
        const zoomFactor = 0.1;
        
        if (delta < 0) {
          // Scroll up - zoom in
          currentScale = Math.min(currentScale + zoomFactor, 3);
        } else {
          // Scroll down - zoom out
          currentScale = Math.max(currentScale - zoomFactor, 1);
        }
        
        slideEl.style.transform = `scale(${currentScale})`;
        isZoomedIn = currentScale > 1.05;
        
        if (isZoomedIn) {
          slideEl.style.zIndex = '10';
        } else {
          slideEl.style.zIndex = '1';
        }
      });
    }

    function setupZoomForSlide(slideEl) {
      // Reset scale for new slide
      currentScale = 1;
      isZoomedIn = false;
      
      if (isMobileDevice()) {
        setupMobilePinch(slideEl);
      } else {
        setupDesktopScroll(slideEl);
      }
    }

    window.addEventListener('load', () => {
      // Primeiro mostra OMOM por 2.5 segundos
      setTimeout(() => {
        $('#omom-screen').fadeOut(500, () => {
          // Depois mostra apoiadores
          $('#supporters-screen').fadeIn(500);
          
          // Apoiadores ficam por 3 segundos
          setTimeout(() => {
            $('#supporters-screen').fadeOut(500, () => {
              // Depois mostra prompt de som
              $('#soundPrompt').fadeIn(300);
            });
          }, 3000);
        });
      }, 2500);
    });

    $('#btnYes').click(() => startSite(true));
    $('#btnNo').click(() => startSite(false));

    function startSite(sound) {
      allowSound = sound;
      $('#soundPrompt').hide();
      if (allowSound) memories.play().catch(() => {});
      $('#menu').fadeIn(300);
    }

    $('.symbol.brither').click(function() {
      const world = $(this).data('world');
      $('html, body').css('background', '#fff');
      $('#menu').css('background', '#fff');

      $('#menu').fadeOut(500, () => {
        $('#flipbook').css('display','flex').fadeIn(500);
        $('#btnVoltar').fadeIn(300);
        $('#fadeTop, #fadeBottom').show();
        if (allowSound) memories.pause();
        
        $.getScript(world + '.js').done(() => {
          initFlipbook('#swiper .swiper-wrapper');
          
          currentSwiper = new Swiper('#swiper', {
            direction: 'vertical',
            loop: false,
            centeredSlides: true,
            slidesPerView: 1,
            spaceBetween: 20,
            allowTouchMove: true,
            on: {
              init: function() {
                setupZoomForSlide(this.slides[this.activeIndex]);
              },
              slideChangeTransitionStart: function() {
                // Reset zoom when changing slides
                document.querySelectorAll('.swiper-slide').forEach(s => {
                  s.style.transform = 'scale(1)';
                  s.style.zIndex = '1';
                });
                currentScale = 1;
                isZoomedIn = false;
                
                // Destroy previous hammer instance
                if (hammerManager) {
                  hammerManager.destroy();
                  hammerManager = null;
                }
              },
              slideChangeTransitionEnd: function() {
                setupZoomForSlide(this.slides[this.activeIndex]);
                if (this.activeIndex === 3) {
                  initGlobe('#globeCanvas');
                }
              }
            }
          });
        });
      });
    });

    $('#btnVoltar').click(() => {
      $('#flipbook').fadeOut(300);
      $('#btnVoltar').fadeOut(300);
      $('.swiper-wrapper').empty();
      $('html, body').css('background', '#000');
      $('#menu').css('background', '#000');
      $('#fadeTop, #fadeBottom').hide();
      
      // Reset zoom variables
      currentScale = 1;
      isZoomedIn = false;
      if (hammerManager) {
        hammerManager.destroy();
        hammerManager = null;
      }
      currentSwiper = null;
      
      if (allowSound) memories.play().catch(() => {});
      $('#menu').fadeIn(500);
    });
  </script>
</body>
</html>
