<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Index – Outros Mundos</title>
  <!-- Importa a fonte "Press Start 2P" -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* Estilos globais */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #000;
      color: #fff;
      font-family: sans-serif;
    }
    /* Loading Screen (já existente) */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: #000;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    #warpCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    #loading-text {
      position: relative;
      font-family: 'Press Start 2P', cursive;
      color: #00FFE7;
      font-size: 20px;
      z-index: 10001;
    }
    /* Conteúdo principal (exemplo simplificado de layout existente) */
    .page-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .title-container {
      text-align: center;
      margin: 5vh auto 0 auto;
      width: 100%;
      position: relative;
      z-index: 2;
    }
    .title-text {
      font-family: 'Press Start 2P', cursive;
      color: #FFFFFF;
      text-align: center;
      line-height: 1.2;
      font-size: 100%;
      text-decoration: none;
      display: block;
    }
    .line { white-space: nowrap; }
    .symbols-wrapper {
      position: absolute;
      top: 150px;
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      padding: 20px;
      z-index: 2;
    }
    .symbols-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
    }
    .symbol {
      position: relative;
      transform-origin: center;
      transition: transform 0.1s linear;
    }
    .symbol img {
      width: 25vw;
      transition: transform 0.3s;
    }
    .symbol img:hover {
      transform: scale(1.1);
    }
    .symbol.brither img { filter: brightness(180%); }
    .symbol.locked img { filter: brightness(50%); }
    /* Modal de escolha de música */
    #musicChoiceModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100000;
    }
    #musicChoiceContent {
      font-family: 'Press Start 2P', cursive;
      color: #00FFE7;
      font-size: 20px;
      text-align: center;
    }
    #musicChoiceContent button {
      font-family: 'Press Start 2P', cursive;
      color: #00FFE7;
      background: transparent;
      border: 2px solid #00FFE7;
      margin: 10px;
      padding: 5px 10px;
      cursor: pointer;
    }
    /* (Os demais estilos, inclusive media queries para PC, permanecem conforme seu código original) */
  </style>
</head>
<body>
  <!-- Modal de escolha de música -->
  <div id="musicChoiceModal" style="display: none;">
    <div id="musicChoiceContent">
      <p>Música?</p>
      <button id="musicYes">Sim</button>
      <button id="musicNo">Não</button>
    </div>
  </div>

  <!-- Loading Screen -->
  <div id="loading-screen">
    <canvas id="warpCanvas"></canvas>
    <div id="loading-text">CARREGANDO...</div>
  </div>

  <!-- Conteúdo Principal -->
  <div class="page-container">
    <div class="title-container">
      <a href="omom.html" class="title-text">
        <span class="line">OUTROS MUNDOS</span><br>
        <span class="line">OUTRAS MENTES</span>
      </a>
    </div>
    <div class="symbols-wrapper">
      <div class="symbols-container">
        <!-- Exemplo: símbolo do mundo de Veleywei -->
        <div class="symbol brither" id="symbol1">
          <a href="mundos/veleywei/index.html" class="world-link">
            <img src="assets/veleyweimenu.png" alt="Velei'wey">
          </a>
        </div>
        <!-- Outros símbolos seguem aqui... -->
      </div>
    </div>
  </div>

  <!-- Música de fundo: memories.mp3 -->
  <audio id="bgm" loop style="display:none;">
    <source src="memories.mp3" type="audio/mpeg">
    Seu navegador não suporta o elemento de áudio.
  </audio>

  <script>
    // Função para iniciar a música com volume 70%
    function playBackgroundMusic() {
      const bgm = document.getElementById("bgm");
      bgm.volume = 0.7;
      bgm.play().catch(err => {
        console.log("Erro ao tocar música:", err);
      });
    }
    
    document.addEventListener("DOMContentLoaded", function() {
      const musicAccepted = localStorage.getItem("musicAccepted");
      const modal = document.getElementById("musicChoiceModal");
      if (musicAccepted === null) {
        // Se ainda não houve escolha, mostra o modal
        modal.style.display = "flex";
      } else if (musicAccepted === "true") {
        playBackgroundMusic();
      }
      
      // Eventos para os botões do modal
      document.getElementById("musicYes").addEventListener("click", function() {
        localStorage.setItem("musicAccepted", "true");
        playBackgroundMusic();
        modal.style.display = "none";
      });
      document.getElementById("musicNo").addEventListener("click", function() {
        localStorage.setItem("musicAccepted", "false");
        modal.style.display = "none";
      });
      
      // Intercepta cliques nos links dos mundos para realizar fade out
      const worldLinks = document.querySelectorAll(".world-link");
      worldLinks.forEach(link => {
        link.addEventListener("click", function(e) {
          e.preventDefault();
          const bgm = document.getElementById("bgm");
          if (!bgm.paused) {
            fadeOutAudio(bgm, 2000, function() {
              window.location.href = link.href;
            });
          } else {
            window.location.href = link.href;
          }
        });
      });
    });
    
    // Função de fade out (diminui gradualmente o volume)
    function fadeOutAudio(audio, duration, callback) {
      const step = 50; // intervalo em ms
      const fadeAmount = audio.volume / (duration / step);
      const fadeInterval = setInterval(function() {
        if (audio.volume > fadeAmount) {
          audio.volume = Math.max(audio.volume - fadeAmount, 0);
        } else {
          clearInterval(fadeInterval);
          audio.pause();
          if (callback) callback();
        }
      }, step);
    }
    
    // (Outras funções já existentes – animação dos símbolos, canvas de fundo, etc.)
    const symbols = document.querySelectorAll('.symbol');
    let time = 0;
    function floatSymbols() {
      time += 0.02;
      symbols.forEach((symbol, index) => {
        let amplitude = 6;
        let speed = 0.1 + (index * 0.01);
        let y = Math.sin(time * speed * 10) * amplitude;
        symbol.style.transform = `translateY(${y}px)`;
      });
      requestAnimationFrame(floatSymbols);
    }
    floatSymbols();
    
    const canvas = document.getElementById("warpCanvas");
    const ctx = canvas.getContext("2d");
    function setupCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      ctx.imageSmoothingEnabled = false;
    }
    setupCanvas();
    const cellSize = 3;
    let cols, rows;
    function updateGridSize() {
      cols = Math.floor(canvas.width / cellSize);
      rows = Math.floor(canvas.height / cellSize);
    }
    updateGridSize();
    let grid = Array.from({ length: rows }, () =>
      Array.from({ length: cols }, () => Math.random() > 0.95 ? 1 : 0)
    );
    function drawGrid() {
      ctx.fillStyle = "black";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#FFFFFF";
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          if (grid[y][x] === 1) {
            ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
          }
        }
      }
    }
    function injectActivity() {
      const injectionSize = 10;
      const corner = Math.floor(Math.random() * 4);
      let startRow, startCol;
      if (corner === 0) {
        startRow = 0; startCol = 0;
      } else if (corner === 1) {
        startRow = 0; startCol = cols - injectionSize;
      } else if (corner === 2) {
        startRow = rows - injectionSize; startCol = 0;
      } else {
        startRow = rows - injectionSize; startCol = cols - injectionSize;
      }
      for (let i = startRow; i < startRow + injectionSize && i < rows; i++) {
        for (let j = startCol; j < startCol + injectionSize && j < cols; j++) {
          if (Math.random() < 0.3) {
            grid[i][j] = 1;
          }
        }
      }
    }
    function updateGrid() {
      let newGrid = grid.map(arr => [...arr]);
      for (let y = 1; y < rows - 1; y++) {
        for (let x = 1; x < cols - 1; x++) {
          let sum = grid[y-1][x] + grid[y+1][x] + grid[y][x-1] + grid[y][x+1] +
                    grid[y-1][x-1] + grid[y-1][x+1] + grid[y+1][x-1] + grid[y+1][x+1];
          newGrid[y][x] = (grid[y][x] === 1) ? ((sum === 2 || sum === 3) ? 1 : 0) : (sum === 3 ? 1 : 0);
        }
      }
      grid = newGrid;
    }
    let frameCount = 0;
    function animate() {
      frameCount++;
      updateGrid();
      if (frameCount % 100 === 0) {
        injectActivity();
      }
      drawGrid();
      requestAnimationFrame(animate);
    }
    animate();
    window.addEventListener("resize", () => {
      setupCanvas();
      updateGridSize();
      grid = Array.from({ length: rows }, () =>
        Array.from({ length: cols }, () => Math.random() > 0.95 ? 1 : 0)
      );
      drawGrid();
    });
    
    window.addEventListener("load", function() {
      document.getElementById("loading-screen").style.display = "none";
    });
  </script>
</body>
</html>
