<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OMOM SPA</title>

  <!-- fonte pixel-art -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

  <style>
    /* ===== RESET ===== */
    * { margin:0; padding:0; box-sizing:border-box; }
    html, body { width:100%; height:100%; overflow:hidden; background:none; color:#fff; font-family:'Courier New',monospace; }

    /* ===== PALCO MADEIRA (grid 50/50) ===== */
    #app {
      display: grid;
      grid-template-rows: 50% 50%;
      width:100%; height:100%;
      background: url(fundo.webp) center/cover no-repeat fixed;
      position: relative;
    }

    /* ===== TABLET + PAINEL ===== */
    :root { --tablet-w:95vw; --tablet-max:640px; }
    .tablet {
      position: relative;
      width: min(var(--tablet-w), var(--tablet-max));
      aspect-ratio: 1/1;
      margin: auto;
      filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5));
    }

    /* LED indicador */
    #led {
      position: absolute;
      top: 12px;
      left: 12px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #000;
      box-shadow: 0 0 5px transparent;
      transition: background 0.1s, box-shadow 0.1s;
      z-index: 11000;
    }

    /* Globo */
    #globe-area {
      position: absolute; width:100%; height:100%;
      top:50%; left:50%; border-radius: 35px; transform:translate(-50%,-50%);
      overflow:hidden; z-index:0;
    }
    #globeCanvas { width:100%; height:100%; background:#000; border-radius: 35px; object-fit:contain; }
    #intro-video {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%); width:40%;
      pointer-events:none; display:none; z-index:2;
    }

    /* Painel cobre tudo */
    #ui-layer { position:absolute; inset:0; z-index:10; pointer-events:none; }
    #painel    { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; pointer-events:none; z-index:10; }

    /* botão MENU */
    #btnMenu {
      position:absolute; top:18px; left:12px;
      background:rgba(0,0,0,0.7); border:2px solid #00FFE7; color:#00FFE7;
      font-family:'Press Start 2P',cursive; font-size:6px; padding:10px;
      cursor:pointer; pointer-events:auto; z-index:11;
    }
    #btnMenu:hover { background:rgba(0,0,0,0.9); }

    /* MENU DE SÍMBOLOS sempre centralizado */
    #menu-overlay {
      position:absolute;
      border-radius: 35px;
      top:50%; left:50%;
      transform:translate(-50%, -50%);
      width:min(var(--tablet-w), var(--tablet-max));
      background:rgba(0,0,0,0.6); backdrop-filter:blur(6px);
      padding:20px 0; display:none; z-index:8;
    }
    #menu-overlay.visible { display:block; }
    .symbols-wrapper { max-height:40vh; padding:32px 20px; overflow-y:auto; }
    .symbols-container { display:flex; flex-wrap:wrap; justify-content:center; gap:25px; }
    .symbol { cursor:pointer; animation:floatWave 4s ease-in-out infinite; }
    .symbol img { width:18vw; max-width:120px; transition:transform .3s; }
    .symbol img:hover { transform:scale(1.1); }
    .symbol.brither img { filter:brightness(180%); }
    .symbol.locked img  { filter:brightness(50%); }

    @keyframes floatWave {
      0%{transform:translateY(0)}50%{transform:translateY(-4px)}100%{transform:translateY(0)}
    }

    /* FLIPBOOK */
    #flipbook-area {
      position:relative; margin-left:5%; padding-top:2vh;
      overflow:hidden; width:100%; height:100%; z-index:3;
      transform:translateX(100%); transition:transform 1.5s ease-out;
    }
    #flipbook-area.show { transform:translateX(0); }
    #flipbook-area.slide-out-left { transform:translateX(-100%); }
    #flipbookContainer { width:100%; height:calc(100% - 7vh); }

    /* seta flipbook */
    #setaBtn { /* ... teu CSS existente ... */ }

    /* OVERLAY IMAGEM */
    #overlayContainer { /* ... teu CSS existente ... */ }
    #btnSair { /* ... teu CSS existente ... */ }

    /* LOADING & SOM */
    #loading-screen { /* ... teu CSS existente ... */ }
    #soundPrompt p, .soundBtn { /* ... teu CSS existente ... */ }

    /* CLIQUES ESPECIAIS */
    /* ... teu CSS existente ... */

    /* ===== DESKTOP: 2 COLUNAS ===== */
    @media screen and (min-width:1024px){
      #app{ /* ... */ }
      #flipbook-area{ /* ... */ }
      .tablet{ /* ... */ }
      #menu-overlay{ /* ... */ }
    }
  </style>
</head>

<body>
  <!-- áudio -->
  <audio id="bgm" src="animus.mp3" preload="auto" loop></audio>
  <audio id="memories" src="memories.mp3" preload="auto" loop></audio>

  <!-- prompt som -->
  <div id="soundPrompt">
    <p>SOM?</p>
    <div class="btnWrap">
      <button class="soundBtn" id="btnYes">SIM</button>
      <button class="soundBtn" id="btnNo">NÃO</button>
    </div>
  </div>

  <!-- palco -->
  <div id="app">
    <section class="tablet">
      <div id="globe-area">
        <canvas id="globeCanvas"></canvas>
        <video id="intro-video" src="omom.mp4" muted playsinline></video>
      </div>
      <div id="ui-layer">
        <img id="painel" src="painel.png" alt="Painel">
        <button id="btnMenu">MENU</button>
      </div>
      <div id="menu-overlay">
        <div class="symbols-wrapper">
          <div class="symbols-container">
            <!-- teus símbolos aqui -->
          </div>
        </div>
      </div>
    </section>
    <section id="flipbook-area"><div id="flipbookContainer"></div></section>
  </div>

  <!-- overlay imagem -->
  <div id="overlayContainer"><button id="btnSair">FECHAR</button><img id="overlayImage" src="" alt="Zoom"></div>
  <!-- loading -->
  <div id="loading-screen"><div id="loading-text">CARREGANDO…</div></div>
  <!-- LED -->
  <div id="led"></div>

  <!-- libs -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="turn.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

  <script>
    // ==== FADE ====
    function fadeIn(a, ms) { /* ... teu código ... */ }
    function fadeOut(a, ms) { /* ... teu código ... */ }

    let allowSound = false;

    // ==== BOOT ====
    window.addEventListener('load', ()=>{
      document.getElementById('loading-screen').style.display = 'none';
      document.getElementById('soundPrompt').style.display = 'flex';
    });
    function startSite(sound) {
      allowSound = sound;
      document.getElementById('soundPrompt').style.display = 'none';
      const intro = document.getElementById('intro-video');
      intro.style.display = 'block';
      intro.play().catch(()=>{});
      if (allowSound) document.getElementById('bgm').play().catch(()=>{});
      intro.addEventListener('ended', ()=>{
        intro.style.display = 'none';
        showOverlayMenu();
      });
    }
    document.getElementById('btnYes').onclick = ()=>startSite(true);
    document.getElementById('btnNo').onclick  = ()=>startSite(false);

    // ==== MENU & MUNDOS ====
    const memories = document.getElementById('memories');
    function showOverlayMenu(){
      document.getElementById('menu-overlay').classList.add('visible');
      if (allowSound) fadeIn(memories, 1000);
    }
    document.querySelector('.symbols-container').addEventListener('click', e=>{
      const sym = e.target.closest('.symbol');
      if (!sym) return;
      launchWorld(sym.dataset.world);
    });
    document.getElementById('btnMenu').onclick = showOverlayMenu;

    function launchWorld(name){ /* ... teu código ... */ }
    function loadWorld(worldName){ /* ... teu código ... */ }
    function destroyGlobe(){ /* ... teu código ... */ }

    // ==== OVERLAY IMAGEM ====
    document.getElementById('btnSair').onclick = e=>{ /* ... */ };
    document.getElementById('overlayContainer').onclick = e=>{ /* ... */ };

    // === LED visualizer (com memories.mp3) ===
    const led      = document.getElementById('led');
    const audioCtx = new AudioContext();
    // usa a mesma variável 'memories' declarada acima
    const src      = audioCtx.createMediaElementSource(memories);
    const analyser = audioCtx.createAnalyser();

    src.connect(analyser);
    analyser.connect(audioCtx.destination);

    const dataArr = new Uint8Array(analyser.frequencyBinCount);

    function updateLed() {
      analyser.getByteFrequencyData(dataArr);
      const avg = dataArr.reduce((s,v) => s+v, 0) / dataArr.length;
      if (avg > 60) {
        led.style.background = '#0f0';
        led.style.boxShadow  = '0 0 15px #0f0';
      } else {
        led.style.background = '#000';
        led.style.boxShadow  = '0 0 5px transparent';
      }
      requestAnimationFrame(updateLed);
    }

    // injeta no boot
    const _origStart = startSite;
    startSite = function(sound) {
      _origStart(sound);
      if (sound) {
        audioCtx.resume();
        updateLed();
      }
    };
  </script>
</body>
</html>
